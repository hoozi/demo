import{c as ee,Y as x,k as n,bf as ie,a as T,bi as ce,dL as de,n as k,d_ as ue,d$ as pe,dP as fe,bn as me,bo as ge,bK as he,v as g,e0 as be,f as C,K as te,J as ye,b0 as oe,Q as w,L as _,aC as b,bW as ve,o as y,j as S,z as m,x as Ce,h as I,aG as F,bs as Me,bq as He,b8 as ke,b as ne,F as Fe,l as z,q as Se,B as A,t as q,aD as W,c_ as $e,bJ as Be,ar as V,az as X,aB as ae,dZ as we,aE as K,aF as U,aH as G,aI as Q,w as le,ap as j,as as Oe,d1 as Pe,d3 as se,aA as Te,N as De}from"./index.664a474d.js";import{u as Re}from"./useWindowSizeFn.bea509a5.js";import{F as Ne,a as We}from"./FullscreenOutlined.6c9757eb.js";const{t:Z}=ee(),_e={visible:{type:Boolean},scrollTop:{type:Boolean,default:!0},height:{type:Number},minHeight:{type:Number},draggable:{type:Boolean,default:!0},centered:{type:Boolean},cancelText:{type:String,default:Z("common.cancelText")},okText:{type:String,default:Z("common.okText")},closeFunc:Function},J=Object.assign({},_e,{defaultFullscreen:{type:Boolean},canFullscreen:{type:Boolean,default:!0},wrapperFooterOffset:{type:Number,default:0},helpMessage:[String,Array],useWrapper:{type:Boolean,default:!0},loading:{type:Boolean},loadingTip:{type:String},showCancelBtn:{type:Boolean,default:!0},showOkBtn:{type:Boolean,default:!0},wrapperProps:Object,afterClose:Function,bodyStyle:Object,closable:{type:Boolean,default:!0},closeIcon:Object,confirmLoading:{type:Boolean},destroyOnClose:{type:Boolean},footer:Object,getContainer:Function,mask:{type:Boolean,default:!0},maskClosable:{type:Boolean,default:!0},keyboard:{type:Boolean,default:!0},maskStyle:Object,okType:{type:String,default:"primary"},okButtonProps:Object,cancelButtonProps:Object,title:{type:String},visible:{type:Boolean},width:[String,Number],wrapClassName:{type:String},zIndex:{type:Number}});function Ee(e){const a=(o,r)=>getComputedStyle(o)[r],c=o=>{if(!o)return;o.setAttribute("data-drag",n(e.draggable));const r=o.querySelector(".ant-modal-header"),t=o.querySelector(".ant-modal");!r||!t||!n(e.draggable)||(r.style.cursor="move",r.onmousedown=l=>{if(!l)return;const u=l.clientX,d=l.clientY,p=document.body.clientWidth,f=document.documentElement.clientHeight,h=t.offsetWidth,v=t.offsetHeight,M=t.offsetLeft,H=p-t.offsetLeft-h,$=t.offsetTop,E=f-t.offsetTop-v,O=a(t,"left"),D=a(t,"top");let R=+O,N=+D;O.includes("%")?(R=+document.body.clientWidth*(+O.replace(/%/g,"")/100),N=+document.body.clientHeight*(+D.replace(/%/g,"")/100)):(R=+O.replace(/px/g,""),N=+D.replace(/px/g,"")),document.onmousemove=function(L){let i=L.clientX-u,B=L.clientY-d;-i>M?i=-M:i>H&&(i=H),-B>$?B=-$:B>E&&(B=E),t.style.cssText+=`;left:${i+R}px;top:${B+N}px;`},document.onmouseup=()=>{document.onmousemove=null,document.onmouseup=null}})},s=()=>{const o=document.querySelectorAll(".ant-modal-wrap");for(const r of Array.from(o)){if(!r)continue;const t=a(r,"display"),l=r.getAttribute("data-drag");t!=="none"&&(l===null||n(e.destroyOnClose))&&c(r)}};x(()=>{!n(e.visible)||!n(e.draggable)||ie(()=>{s()},30)})}function Le(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!fe(e)}var je=T({name:"Modal",inheritAttrs:!1,props:J,emits:["cancel"],setup(e,{slots:a,emit:c}){const{visible:s,draggable:o,destroyOnClose:r}=ce(e),t=de();Ee({visible:s,destroyOnClose:r,draggable:o});const l=u=>{c("cancel",u)};return()=>{let u;const d={...n(t),...e,onCancel:l};return k(pe,d,Le(u=ue(a))?u:{default:()=>[u]})}}});const re=Symbol();function Ie(e){return me(e,re)}function it(){return ge(re)}const xe={loading:{type:Boolean},useWrapper:{type:Boolean,default:!0},modalHeaderHeight:{type:Number,default:57},modalFooterHeight:{type:Number,default:74},minHeight:{type:Number,default:200},height:{type:Number},footerOffset:{type:Number,default:0},visible:{type:Boolean},fullScreen:{type:Boolean},loadingTip:{type:String}},Ve=T({name:"ModalWrapper",components:{ScrollContainer:he},inheritAttrs:!1,props:xe,emits:["height-change","ext-height"],setup(e,{emit:a}){const c=g(null),s=g(null),o=g(0),r=g(0);let t=0;Re(d.bind(null,!1)),be(s,()=>{d()},{attributes:!0,subtree:!0}),Ie({redoModalHeight:d});const l=C(()=>({minHeight:`${e.minHeight}px`,[e.fullScreen?"height":"maxHeight"]:`${n(o)}px`}));x(()=>{e.useWrapper&&d()}),te(()=>e.fullScreen,p=>{d(),p?r.value=o.value:o.value=r.value}),ye(()=>{const{modalHeaderHeight:p,modalFooterHeight:f}=e;a("ext-height",p+f)}),oe(()=>{});async function u(){w(()=>{const p=n(c);!p||p?.scrollTo?.(0)})}async function d(){if(!e.visible)return;const p=n(c);if(!p)return;const f=p.$el.parentElement;if(!!f){f.style.padding="0",await w();try{const h=f.parentElement&&f.parentElement.parentElement;if(!h)return;const v=getComputedStyle(h).top,M=Number.parseInt(v);let H=window.innerHeight-M*2+(e.footerOffset||0)-e.modalFooterHeight-e.modalHeaderHeight;M<40&&(H-=26),await w();const $=n(s);if(!$)return;await w(),t=$.scrollHeight,e.fullScreen?o.value=window.innerHeight-e.modalFooterHeight-e.modalHeaderHeight-28:o.value=e.height?e.height:t>H?H:t,a("height-change",n(o))}catch(h){}}}return{wrapperRef:c,spinRef:s,spinStyle:l,scrollTop:u,setModalHeight:d}}}),ze=["loading-tip"];function Ae(e,a,c,s,o,r){const t=b("ScrollContainer"),l=ve("loading");return y(),S(t,{ref:"wrapperRef"},{default:m(()=>[Ce((y(),I("div",{ref:"spinRef",style:Me(e.spinStyle),"loading-tip":e.loadingTip},[F(e.$slots,"default")],12,ze)),[[l,e.loading]])]),_:3},512)}var qe=_(Ve,[["render",Ae]]);const Ye=T({name:"ModalClose",components:{Tooltip:He,FullscreenExitOutlined:Ne,FullscreenOutlined:We,CloseOutlined:ke},props:{canFullscreen:{type:Boolean,default:!0},fullScreen:{type:Boolean}},emits:["cancel","fullscreen"],setup(e,{emit:a}){const{prefixCls:c}=ne("basic-modal-close"),{t:s}=ee(),o=C(()=>[c,`${c}--custom`,{[`${c}--can-full`]:e.canFullscreen}]);function r(l){a("cancel",l)}function t(l){l?.stopPropagation(),l?.preventDefault(),a("fullscreen")}return{t:s,getClass:o,prefixCls:c,handleCancel:r,handleFullScreen:t}}});function Xe(e,a,c,s,o,r){const t=b("FullscreenExitOutlined"),l=b("Tooltip"),u=b("FullscreenOutlined"),d=b("CloseOutlined");return y(),I("div",{class:Se(e.getClass)},[e.canFullscreen?(y(),I(Fe,{key:0},[e.fullScreen?(y(),S(l,{key:0,title:e.t("component.modal.restore"),placement:"bottom"},{default:m(()=>[k(t,{role:"full",onClick:e.handleFullScreen},null,8,["onClick"])]),_:1},8,["title"])):(y(),S(l,{key:1,title:e.t("component.modal.maximize"),placement:"bottom"},{default:m(()=>[k(u,{role:"close",onClick:e.handleFullScreen},null,8,["onClick"])]),_:1},8,["title"]))],64)):z("",!0),k(l,{title:e.t("component.modal.close"),placement:"bottom"},{default:m(()=>[k(d,{onClick:e.handleCancel},null,8,["onClick"])]),_:1},8,["title"])],2)}var Je=_(Ye,[["render",Xe]]);const Ke=T({name:"BasicModalFooter",props:J,emits:["ok","cancel"],setup(e,{emit:a}){function c(o){a("ok",o)}function s(o){a("cancel",o)}return{handleOk:c,handleCancel:s}}});function Ue(e,a,c,s,o,r){const t=b("a-button");return y(),I("div",null,[F(e.$slots,"insertFooter"),e.showCancelBtn?(y(),S(t,W({key:0},e.cancelButtonProps,{onClick:e.handleCancel}),{default:m(()=>[A(q(e.cancelText),1)]),_:1},16,["onClick"])):z("",!0),F(e.$slots,"centerFooter"),e.showOkBtn?(y(),S(t,W({key:1,type:e.okType,onClick:e.handleOk,loading:e.confirmLoading},e.okButtonProps),{default:m(()=>[A(q(e.okText),1)]),_:1},16,["type","onClick","loading"])):z("",!0),F(e.$slots,"appendFooter")])}var Ge=_(Ke,[["render",Ue]]);const Qe=T({name:"BasicModalHeader",components:{BasicTitle:$e},props:{helpMessage:{type:[String,Array]},title:{type:String}},emits:["dblclick"]});function Ze(e,a,c,s,o,r){const t=b("BasicTitle");return y(),S(t,{helpMessage:e.helpMessage},{default:m(()=>[A(q(e.title),1)]),_:1},8,["helpMessage"])}var et=_(Qe,[["render",Ze]]);function tt(e){const a=g(!1),c=C(()=>{const o=n(e.wrapClassName)||"";return n(a)?`fullscreen-modal ${o} `:n(o)});function s(o){o&&o.stopPropagation(),a.value=!n(a)}return{getWrapClassName:c,handleFullScreen:s,fullScreenRef:a}}const ot=T({name:"BasicModal",components:{Modal:je,ModalWrapper:qe,ModalClose:Je,ModalFooter:Ge,ModalHeader:et},inheritAttrs:!1,props:J,emits:["visible-change","height-change","cancel","ok","register","update:visible"],setup(e,{emit:a,attrs:c}){const s=g(!1),o=g(null),r=g(null),{prefixCls:t}=ne("basic-modal"),l=g(0),u={setModalProps:O,emitVisible:void 0,redoModalHeight:()=>{w(()=>{n(r)&&n(r).setModalHeight()})}},d=X();d&&a("register",u,d.uid);const p=C(()=>({...e,...n(o)})),{handleFullScreen:f,getWrapClassName:h,fullScreenRef:v}=tt({modalWrapperRef:r,extHeightRef:l,wrapClassName:Be(p.value,"wrapClassName")}),M=C(()=>({...{...n(p),visible:n(s),okButtonProps:void 0,cancelButtonProps:void 0,title:void 0},wrapClassName:n(h)})),H=C(()=>{const i={...c,...n(p),visible:n(s),wrapClassName:n(h)};return n(v)?V(i,["height","title"]):V(i,"title")}),$=C(()=>{if(!n(v))return n(M).height});x(()=>{s.value=!!e.visible,v.value=!!e.defaultFullscreen}),te(()=>n(s),i=>{a("visible-change",i),a("update:visible",i),d&&u.emitVisible?.(i,d.uid),w(()=>{e.scrollTop&&i&&n(r)&&n(r).scrollTop()})},{immediate:!1});async function E(i){if(i?.stopPropagation(),!i.target?.classList?.contains(t+"-close--custom")){if(e.closeFunc&&ae(e.closeFunc)){const B=await e.closeFunc();s.value=!B;return}s.value=!1,a("cancel",i)}}function O(i){o.value=we(n(o)||{},i),Reflect.has(i,"visible")&&(s.value=!!i.visible),Reflect.has(i,"defaultFullscreen")&&(v.value=!!i.defaultFullscreen)}function D(i){a("ok",i)}function R(i){a("height-change",i)}function N(i){l.value=i}function L(i){!e.canFullscreen||(i.stopPropagation(),f(i))}return{handleCancel:E,getBindValue:H,getProps:M,handleFullScreen:f,fullScreenRef:v,getMergeProps:p,handleOk:D,visibleRef:s,omit:V,modalWrapperRef:r,handleExtHeight:N,handleHeightChange:R,handleTitleDbClick:L,getWrapperHeight:$}}});function nt(e,a,c,s,o,r){const t=b("ModalClose"),l=b("ModalHeader"),u=b("ModalFooter"),d=b("ModalWrapper"),p=b("Modal");return y(),S(p,W(e.getBindValue,{onCancel:e.handleCancel}),K({default:m(()=>[e.getProps.scrollable?(y(),S(d,W({key:0,useWrapper:e.getProps.useWrapper,footerOffset:e.wrapperFooterOffset,fullScreen:e.fullScreenRef,ref:"modalWrapperRef",loading:e.getProps.loading,"loading-tip":e.getProps.loadingTip,minHeight:e.getProps.minHeight,height:e.getWrapperHeight,visible:e.visibleRef,modalFooterHeight:e.footer!==void 0&&!e.footer?0:void 0},e.omit(e.getProps.wrapperProps,"visible","height","modalFooterHeight"),{onExtHeight:e.handleExtHeight,onHeightChange:e.handleHeightChange}),{default:m(()=>[F(e.$slots,"default")]),_:3},16,["useWrapper","footerOffset","fullScreen","loading","loading-tip","minHeight","height","visible","modalFooterHeight","onExtHeight","onHeightChange"])):F(e.$slots,"default",{key:1})]),_:2},[e.$slots.closeIcon?void 0:{name:"closeIcon",fn:m(()=>[k(t,{canFullscreen:e.getProps.canFullscreen,fullScreen:e.fullScreenRef,onCancel:e.handleCancel,onFullscreen:e.handleFullScreen},null,8,["canFullscreen","fullScreen","onCancel","onFullscreen"])])},e.$slots.title?void 0:{name:"title",fn:m(()=>[k(l,{helpMessage:e.getProps.helpMessage,title:e.getMergeProps.title,onDblclick:e.handleTitleDbClick},null,8,["helpMessage","title","onDblclick"])])},e.$slots.footer?void 0:{name:"footer",fn:m(()=>[k(u,W(e.getBindValue,{onOk:e.handleOk,onCancel:e.handleCancel}),K({_:2},[U(Object.keys(e.$slots),f=>({name:f,fn:m(h=>[F(e.$slots,f,G(Q(h||{})))])}))]),1040,["onOk","onCancel"])])},U(Object.keys(e.omit(e.$slots,"default")),f=>({name:f,fn:m(h=>[F(e.$slots,f,G(Q(h||{})))])}))]),1040,["onCancel"])}var at=_(ot,[["render",nt]]);const P=le({}),Y=le({});function ct(){const e=g(null),a=g(!1),c=g("");function s(t,l){if(!X())throw new Error("useModal() can only be used inside setup() or functional components!");c.value=l,oe(()=>{e.value=null,a.value=!1,P[n(c)]=null}),!(n(a)&&Pe()&&t===n(e))&&(e.value=t,a.value=!0,t.emitVisible=(u,d)=>{Y[d]=u})}const o=()=>{const t=n(e);return t||se("useModal instance is undefined!"),t},r={setModalProps:t=>{o()?.setModalProps(t)},getVisible:C(()=>Y[~~n(c)]),redoModalHeight:()=>{o()?.redoModalHeight?.()},openModal:(t=!0,l,u=!0)=>{if(o()?.setModalProps({visible:t}),!l)return;const d=n(c);if(u){P[d]=null,P[d]=j(l);return}Oe(j(P[d]),j(l))||(P[d]=j(l))},closeModal:()=>{o()?.setModalProps({visible:!1})}};return[s,r]}const dt=e=>{const a=g(null),c=X(),s=g(""),o=()=>{const t=n(a);return t||se("useModalInner instance is undefined!"),t},r=(t,l)=>{Te(()=>{a.value=null}),s.value=l,a.value=t,c?.emit("register",t,l)};return x(()=>{const t=P[n(s)];!t||!e||!ae(e)||w(()=>{e(t)})}),[r,{changeLoading:(t=!0)=>{o()?.setModalProps({loading:t})},getVisible:C(()=>Y[~~n(s)]),changeOkLoading:(t=!0)=>{o()?.setModalProps({confirmLoading:t})},closeModal:()=>{o()?.setModalProps({visible:!1})},setModalProps:t=>{o()?.setModalProps(t)},redoModalHeight:()=>{const t=o()?.redoModalHeight;t&&t()}}]},ut=De(at);export{ut as B,it as a,dt as b,ct as u};
